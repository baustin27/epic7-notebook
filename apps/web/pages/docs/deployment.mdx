---
title: Deployment Guide
description: Deploy the AI Chat Platform to production environments
---

# Deployment Guide

This guide covers deploying the AI Chat Platform to production environments, including Vercel, Docker, and custom server setups.

## Quick Deploy (Vercel)

### One-Click Deploy

[![Deploy with Vercel](https://vercel.com/button)](https://vercel.com/new/clone?repository-url=https://github.com/your-org/ai-chat-platform)

### Manual Vercel Deployment

1. **Connect Repository**
   ```bash
   # Install Vercel CLI
   npm i -g vercel

   # Login to Vercel
   vercel login

   # Deploy from project root
   cd apps/web
   vercel
   ```

2. **Environment Variables**
   Set the following in Vercel dashboard or using CLI:

   ```bash
   vercel env add NEXT_PUBLIC_SUPABASE_URL
   vercel env add NEXT_PUBLIC_SUPABASE_ANON_KEY
   vercel env add SUPABASE_SERVICE_ROLE_KEY
   vercel env add OPENROUTER_API_KEY
   ```

3. **Build Configuration**
   Vercel automatically detects Next.js projects. The build configuration is in `vercel.json`:

   ```json
   {
     "buildCommand": "npm run build",
     "outputDirectory": ".next",
     "framework": "nextjs",
     "regions": ["iad1"]
   }
   ```

## Environment Configuration

### Production Environment Variables

```env
# Application
NODE_ENV=production
NEXT_PUBLIC_APP_URL=https://your-domain.com

# Supabase (Production)
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_prod_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_prod_service_role_key

# OpenRouter
OPENROUTER_API_KEY=your_prod_openrouter_key

# Analytics (Optional)
NEXT_PUBLIC_GA_ID=GA_MEASUREMENT_ID
MIXPANEL_TOKEN=your_mixpanel_token

# Security
NEXTAUTH_SECRET=your_nextauth_secret
NEXTAUTH_URL=https://your-domain.com

# Database (if using custom PostgreSQL)
DATABASE_URL=postgresql://user:pass@host:5432/dbname
```

### Environment-Specific Settings

#### Development
```env
NODE_ENV=development
NEXT_PUBLIC_APP_URL=http://localhost:3000
# Use development/staging Supabase project
```

#### Staging
```env
NODE_ENV=staging
NEXT_PUBLIC_APP_URL=https://staging.your-domain.com
# Use staging Supabase project
```

#### Production
```env
NODE_ENV=production
NEXT_PUBLIC_APP_URL=https://your-domain.com
# Use production Supabase project
```

## Database Setup

### Supabase Production Setup

1. **Create Production Project**
   ```bash
   # Create new Supabase project
   supabase projects create "ai-chat-prod"

   # Or use Supabase dashboard
   ```

2. **Database Migrations**
   ```bash
   # Link to production project
   supabase link --project-ref your-prod-project-ref

   # Run migrations
   supabase db push

   # Seed initial data (if needed)
   supabase db reset
   ```

3. **Backup Configuration**
   - Enable automated backups in Supabase dashboard
   - Set backup retention period (recommended: 30 days)
   - Configure backup notifications

### Custom PostgreSQL Setup

If using a custom PostgreSQL instance:

```sql
-- Create database
CREATE DATABASE ai_chat_prod;

-- Create user
CREATE USER ai_chat_user WITH ENCRYPTED PASSWORD 'secure_password';

-- Grant permissions
GRANT ALL PRIVILEGES ON DATABASE ai_chat_prod TO ai_chat_user;

-- Enable extensions
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
CREATE EXTENSION IF NOT EXISTS "pgcrypto";
```

## Security Configuration

### Authentication Setup

1. **Supabase Auth Configuration**
   - Configure site URL: `https://your-domain.com`
   - Set redirect URLs for OAuth providers
   - Enable required authentication methods

2. **JWT Token Configuration**
   ```env
   SUPABASE_JWT_SECRET=your_jwt_secret
   JWT_EXPIRES_IN=7d
   ```

### API Security

1. **Rate Limiting**
   - Configure rate limits based on user tiers
   - Implement Redis for distributed rate limiting

2. **CORS Configuration**
   ```javascript
   // next.config.js
   module.exports = {
     async headers() {
       return [
         {
           source: '/api/:path*',
           headers: [
             { key: 'Access-Control-Allow-Origin', value: 'https://your-domain.com' },
             { key: 'Access-Control-Allow-Methods', value: 'GET,POST,PUT,DELETE' },
             { key: 'Access-Control-Allow-Headers', value: 'Content-Type,Authorization' }
           ]
         }
       ]
     }
   }
   ```

### SSL/TLS Configuration

- Use HTTPS in production (Vercel provides this automatically)
- Configure SSL certificates for custom domains
- Enable HSTS headers

## Performance Optimization

### Build Optimization

```javascript
// next.config.js
module.exports = {
  swcMinify: true,
  compiler: {
    removeConsole: process.env.NODE_ENV === 'production'
  },
  experimental: {
    optimizeCss: true,
    scrollRestoration: true
  }
}
```

### Image Optimization

```javascript
// next.config.js
module.exports = {
  images: {
    domains: ['your-domain.com', 'supabase.co'],
    formats: ['image/webp', 'image/avif'],
    deviceSizes: [640, 750, 828, 1080, 1200, 1920, 2048, 3840],
    imageSizes: [16, 32, 48, 64, 96, 128, 256, 384]
  }
}
```

### Caching Strategy

1. **Static Asset Caching**
   ```javascript
   // next.config.js
   module.exports = {
     async headers() {
       return [
         {
           source: '/static/:path*',
           headers: [
             {
               key: 'Cache-Control',
               value: 'public, max-age=31536000, immutable'
             }
           ]
         }
       ]
     }
   }
   ```

2. **API Response Caching**
   - Implement Redis for API response caching
   - Use appropriate cache headers for different endpoints

## Monitoring and Analytics

### Application Monitoring

1. **Vercel Analytics**
   - Enable Vercel Analytics in dashboard
   - Monitor performance metrics and errors

2. **Custom Monitoring**
   ```javascript
   // lib/monitoring.ts
   export const logError = (error: Error, context?: any) => {
     // Send to error tracking service (Sentry, LogRocket, etc.)
     console.error('Application Error:', error, context)
   }

   export const trackEvent = (event: string, properties?: any) => {
     // Send to analytics service (Mixpanel, Amplitude, etc.)
     console.log('Event:', event, properties)
   }
   ```

### Database Monitoring

1. **Supabase Monitoring**
   - Monitor query performance
   - Set up alerts for high resource usage
   - Track API usage and limits

2. **Custom Metrics**
   - Track user engagement
   - Monitor AI model usage and costs
   - Log performance metrics

## CI/CD Pipeline

The project uses a comprehensive CI/CD pipeline with GitHub Actions that includes automated testing, security scanning, deployment automation, and performance monitoring.

### Pipeline Overview

The CI/CD pipeline consists of three main workflows:

1. **Test Suite** (`.github/workflows/test.yml`) - Comprehensive testing and quality gates
2. **Deploy** (`.github/workflows/deploy.yml`) - Automated deployment with environments
3. **Performance Monitoring** (`.github/workflows/monitoring.yml`) - Ongoing performance tracking

### Test Suite Workflow

The test workflow runs on every push and pull request:

```yaml
# Key features:
- Multi-environment testing (Node 18, 20)
- Type checking and linting
- Unit and integration tests with coverage
- E2E testing with Playwright
- Performance testing with Lighthouse
- Accessibility testing
- Bundle analysis
- Security scanning (npm audit, CodeQL, Trivy)
- Storybook deployment
```

**Quality Gates:**
- Test coverage must be â‰¥80%
- All linting rules must pass
- Security scans must pass
- Bundle size within limits
- Performance budgets met

### Deployment Workflow

Automated deployment with environment-specific configurations:

```yaml
# Deployment stages:
- Preview deployments for all PRs
- Staging deployment from develop branch
- Production deployment from main branch with manual approval
- Automatic rollback on deployment failures
```

**Environment Secrets Required:**
- `VERCEL_TOKEN`: Vercel API token
- `VERCEL_ORG_ID`: Vercel organization ID
- `VERCEL_PROJECT_ID`: Vercel project ID
- `GITHUB_TOKEN`: For automated operations

### Performance Monitoring

Daily automated performance monitoring:

```yaml
# Monitoring features:
- Bundle size tracking with regression alerts
- Core Web Vitals monitoring (LCP, FID, CLS)
- Lighthouse performance audits
- Automated issue creation for regressions
- Health checks and API monitoring
```

### Manual Deployment

For emergency deployments or manual control:

```bash
# Trigger manual deployment
gh workflow run deploy.yml -f environment=staging
gh workflow run deploy.yml -f environment=production
```

### Rollback Procedures

**Automatic Rollback:**
- Triggered automatically on deployment failures
- Uses Vercel's rollback capability
- Creates GitHub issue for notification

**Manual Rollback:**
```bash
# Via Vercel CLI
vercel rollback

# Via GitHub Actions
gh workflow run deploy.yml -f rollback=true
```

### Troubleshooting CI/CD Issues

**Common Issues:**

1. **Build Failures**
   ```bash
   # Check build logs
   gh run list --workflow=test.yml
   gh run view <run-id> --log
   ```

2. **Deployment Issues**
   - Verify Vercel secrets are set correctly
   - Check Vercel project configuration
   - Review deployment logs in Vercel dashboard

3. **Test Failures**
   ```bash
   # Run tests locally
   npm run test:ci
   npm run test:e2e
   ```

4. **Performance Regressions**
   - Check Lighthouse results in artifacts
   - Review bundle analysis reports
   - Verify Core Web Vitals metrics

**Debugging Steps:**
1. Check GitHub Actions logs for detailed error messages
2. Verify environment variables and secrets
3. Test builds locally with `npm run build`
4. Review Vercel deployment logs
5. Check Supabase connection and API keys

### Environment Secrets

Set the following secrets in GitHub repository:

- `VERCEL_TOKEN`: Vercel API token
- `VERCEL_ORG_ID`: Vercel organization ID
- `VERCEL_PROJECT_ID`: Vercel project ID
- `SUPABASE_ACCESS_TOKEN`: Supabase access token (for migrations)

## Docker Deployment

### Dockerfile

```dockerfile
FROM node:18-alpine AS base

# Install dependencies only when needed
FROM base AS deps
RUN apk add --no-cache libc6-compat
WORKDIR /app

COPY package.json package-lock.json ./
RUN npm ci --only=production

# Rebuild the source code only when needed
FROM base AS builder
WORKDIR /app
COPY --from=deps /app/node_modules ./node_modules
COPY . .

ENV NEXT_TELEMETRY_DISABLED 1
RUN npm run build

# Production image, copy all the files and run next
FROM base AS runner
WORKDIR /app

ENV NODE_ENV production
ENV NEXT_TELEMETRY_DISABLED 1

RUN addgroup --system --gid 1001 nodejs
RUN adduser --system --uid 1001 nextjs

COPY --from=builder /app/public ./public
COPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./
COPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static

USER nextjs

EXPOSE 3000
ENV PORT 3000

CMD ["node", "server.js"]
```

### Docker Compose

```yaml
version: '3.8'

services:
  app:
    build: .
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - NEXT_PUBLIC_SUPABASE_URL=${NEXT_PUBLIC_SUPABASE_URL}
      - NEXT_PUBLIC_SUPABASE_ANON_KEY=${NEXT_PUBLIC_SUPABASE_ANON_KEY}
    depends_on:
      - redis

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"

  postgres:
    image: postgres:15-alpine
    environment:
      - POSTGRES_DB=ai_chat
      - POSTGRES_USER=ai_chat_user
      - POSTGRES_PASSWORD=${DB_PASSWORD}
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"

volumes:
  postgres_data:
```

## Backup and Recovery

### Database Backup

```bash
# Automated backup script
#!/bin/bash
BACKUP_DIR="/backups"
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_FILE="$BACKUP_DIR/ai_chat_$DATE.sql"

# Create backup
pg_dump -h $DB_HOST -U $DB_USER -d $DB_NAME > $BACKUP_FILE

# Compress
gzip $BACKUP_FILE

# Upload to cloud storage (AWS S3, Google Cloud, etc.)
aws s3 cp $BACKUP_FILE.gz s3://your-backup-bucket/

# Clean up old backups (keep last 30 days)
find $BACKUP_DIR -name "*.gz" -mtime +30 -delete
```

### Application Backup

- Backup environment configurations
- Backup user-uploaded content
- Document recovery procedures

## Scaling Considerations

### Horizontal Scaling

1. **Load Balancing**
   - Use Vercel's built-in load balancing
   - Configure custom load balancers for multi-region deployment

2. **Database Scaling**
   - Monitor database performance
   - Consider read replicas for high-traffic applications
   - Implement database sharding if needed

### Performance Monitoring

1. **Key Metrics to Monitor**
   - Response times
   - Error rates
   - Database query performance
   - Memory and CPU usage
   - AI model response times

2. **Alerting**
   - Set up alerts for critical metrics
   - Configure notification channels (email, Slack, etc.)

## Troubleshooting Production Issues

### Common Issues

1. **Build Failures**
   ```bash
   # Check build logs
   vercel logs

   # Clear build cache
   vercel rm your-project-name
   ```

2. **Runtime Errors**
   - Check application logs in Vercel dashboard
   - Monitor error tracking services
   - Verify environment variables

3. **Database Issues**
   - Check Supabase status page
   - Monitor database connections
   - Verify migration status

### Rollback Strategy

1. **Immediate Rollback**
   ```bash
   # Rollback to previous deployment
   vercel rollback
   ```

2. **Database Rollback**
   ```bash
   # Restore from backup
   pg_restore -h $DB_HOST -U $DB_USER -d $DB_NAME backup_file.sql
   ```

## Cost Optimization

### Vercel Costs
- Monitor function execution times
- Optimize bundle size
- Use appropriate pricing plan

### Supabase Costs
- Monitor database usage
- Optimize queries
- Configure appropriate compute resources

### AI Model Costs
- Track OpenRouter API usage
- Implement cost limits per user
- Cache frequent responses

---

*For additional support, check the [Troubleshooting](troubleshooting) guide or contact the development team.*