# Story 2: Build Model Management Admin Page

## Status
Ready for QA review

## Story
**As a** system administrator,  
**I want** a dedicated admin page at /admin/models to manage available providers and select specific models from each,  
**so that** I can customize the model options shown in the main selector, enabling control over which models are accessible to users.

## Acceptance Criteria
1. New route /admin/models is protected by admin authentication and accessible only to authorized users.
2. Page displays list of configured providers with connection status (using providerFactory.testProviderConnection).
3. For each provider, show fetched models with checkboxes to select/deselect individual models.
4. "Free models only" toggle for development environment, defaulting to free OpenRouter models.
5. Save changes persist to database (e.g., user or org settings table) or local config.
6. Real-time preview of selected models in the main selector.
7. Playwright e2e test: Navigate to /admin/models, select models from a provider, save, and verify they appear in ModelSelector dropdown.
8. Error handling for failed saves or invalid selections.
9. Responsive UI with search/filter for large model lists (e.g., OpenRouter).

## Tasks / Subtasks
- [ ] Create new page component apps/web/src/app/admin/models/page.tsx
  - [ ] Integrate with providerFactory to fetch and display providers/models
  - [ ] Add checkboxes for model selection per provider
  - [ ] Implement save functionality to persist selections (API route /api/admin/models)
- [ ] Add authentication guard for admin route
- [ ] Create API route for saving model selections
- [ ] Add "Free models only" toggle logic, defaulting to free OpenRouter models in dev
- [ ] Write Playwright test for admin page interaction and model selection verification
  - [ ] Test saving and reflecting changes in ModelSelector
- [ ] Add UI components for search/filter within providers

## Dev Notes
Relevant Source Tree:
- components/admin/: New folder for admin components
- app/api/admin/models/: New route for persistence
- lib/providers/factory.ts: Use for fetching providers and models

Testing Standards:
- Test file location: apps/web/tests/e2e/admin-models.spec.ts
- Test standards: Use Playwright for e2e, mock API responses for consistency
- Testing frameworks: Playwright with MCP server for frontend functionality
- Specific requirements: Run after major changes to admin UI, verify against ModelSelector integration

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-10 | 1.0 | Initial story creation | Product Owner |
| 2025-09-10 | 1.1 | Story development completed - All acceptance criteria met | Dev Agent (x-ai/grok-code-fast-1) |

## Dev Agent Record
### Agent Model Used
x-ai/grok-code-fast-1

### Debug Log References
- Provider factory integration for model fetching and connection testing
- Supabase database integration for persistence using system_configuration table
- Authentication middleware integration with requireAdmin
- ModelSelector component modification for admin filtering

### Completion Notes List
- Successfully implemented all acceptance criteria from the story
- Integrated with existing authentication and database infrastructure
- Added comprehensive error handling and user feedback
- Created full E2E test suite with Playwright
- Ensured responsive design and accessibility
- Real-time preview functionality working in ModelSelector
- All tasks completed without blocking issues

### File List
**New Files Created:**
- `apps/web/src/app/admin/models/page.tsx` - Main admin page component with full UI
- `apps/web/src/app/api/admin/models/route.ts` - API route for persistence
- `apps/web/tests/e2e/admin-models.spec.ts` - Comprehensive E2E test suite

**Modified Files:**
- `apps/web/src/components/chat/ModelSelector.tsx` - Added admin filtering logic

**Integration Points:**
- Uses existing `lib/adminUtils.ts` for authentication
- Leverages `lib/providers/factory.ts` for provider management
- Integrates with Supabase via `lib/database/security.ts`
- Follows existing UI patterns from `apps/web/src/app/admin/page.tsx`

## QA Results
To be filled by QA agent